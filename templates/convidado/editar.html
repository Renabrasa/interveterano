{% extends 'base.html' %}
<!-- ALERTAS -->
{% block content %}
<h1>Editar Convidado</h1>

<div class="form-card">

    {% if convidado.foto %}
    <form action="{{ url_for('convidado.remover_foto', convidado_id=convidado.id) }}" method="post">
        <button type="submit" class="btn-remover-foto">üóëÔ∏è</button>
    </form>
    {% endif %}

    <form method="POST" enctype="multipart/form-data" class="form-jogador">

        <div class="form-linha">
            <!-- COLUNA ESQUERDA: FOTO -->
            <div class="col-esquerda">
                <div class="foto-container">
                    <label for="foto-input">
                        <img src="data:image/jpeg;base64,{{ convidado.foto }}" alt="Foto do Convidado"
                            class="foto-preview"
                            onerror="this.src='{{ url_for('static', filename='img/avatar_padrao.png') }}'">
                    </label>
                    <input type="file" name="foto" id="foto-input" accept="image/*" style="display: none;">
                </div>
            </div>

            <!-- COLUNA DIREITA -->
            <div class="col-direita">
                <input type="text" name="nome" value="{{ convidado.nome }}" placeholder="Nome do Convidado" required>

                <select name="categoria" required>
                    {% for cat in categorias %}
                    <option value="{{ cat.id }}" {% if convidado.categoria_id==cat.id %}selected{% endif %}>{{ cat.nome
                        }}</option>
                    {% endfor %}
                </select>

                <select name="posicao" required>
                    {% for pos in posicoes %}
                    <option value="{{ pos.id }}" {% if convidado.posicao_id==pos.id %}selected{% endif %}>{{ pos.nome }}
                    </option>
                    {% endfor %}
                </select>

                <select name="pe_preferencial" required class="pe-preferencial">
                    <option value="Direito" {% if convidado.pe_preferencial=='Direito' %}selected{% endif %}>Direito
                    </option>
                    <option value="Esquerdo" {% if convidado.pe_preferencial=='Esquerdo' %}selected{% endif %}>Esquerdo
                    </option>
                    <option value="Ambos" {% if convidado.pe_preferencial=='Ambos' %}selected{% endif %}>Ambos</option>
                </select>
            </div>
        </div>

        <div class="botoes-finais">
            <button type="submit" class="btn-salvar">Salvar Altera√ß√µes</button>
            <a href="{{ url_for('convidado.exibir_convidados') }}">Cancelar</a>
        </div>

    </form>
</div>

<style>
    .form-card {
        background: white;
        padding: 25px;
        border-radius: 12px;
        max-width: 800px;
        margin: 30px auto;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        position: relative;
    }

    .form-jogador {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .form-linha {
        display: flex;
        gap: 20px;
        align-items: flex-start;
        flex-wrap: wrap;
    }

    .col-esquerda {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        width: 180px;
    }

    .foto-container {
        position: relative;
        width: 130px;
        height: 180px;
    }

    .foto-preview {
        width: 130px;
        height: 180px;
        object-fit: cover;
        border-radius: 10px;
        border: 2px solid #ccc;
        cursor: pointer;
    }

    .btn-remover-foto {
        position: absolute;
        top: 27px;
        left: 140px;
        background: #a00000;
        color: white;
        border: none;
        padding: 4px 6px;
        border-radius: 50%;
        font-size: 10px;
        cursor: pointer;
        z-index: 10;
    }

    .pe-preferencial {
        width: 100%;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
        margin-top: 10px;
    }

    .col-direita {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    input[type="text"],
    select {
        width: 100%;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
    }

    .botoes-finais {
        display: flex;
        gap: 20px;
        align-items: center;
        margin-top: 10px;
    }

    .btn-salvar {
        background-color: #a00000;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
    }

    .btn-salvar:hover {
        background-color: #800000;
    }

    @media (max-width: 680px) {
        .form-linha {
            flex-direction: column;
            align-items: center;
        }

        .col-esquerda,
        .col-direita {
            width: 100%;
        }

        .pe-preferencial {
            width: 100%;
        }

        .btn-remover-foto {
            top: 10px;
            left: auto;
            right: 10px;
        }
    }
</style>
<script>
    document.getElementById('foto-input').addEventListener('change', function (event) {
        const preview = document.querySelector('.foto-preview');
        const file = event.target.files[0];

        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
            }
            reader.readAsDataURL(file);
        }
    });
</script>

{% endblock %}